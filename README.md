## Ветка с программной проверкой события КЗ
# Встраиваемого ФПО (версия 2) автомата розеточного (АР) в версии с нормально замкнутыми реле 5В под процессор STM32H743

### Изменения и дополнения версии:
	* Управление силовой частью от 24В
	* Аппаратный (с помощью таймера, дма и шим) выключатель выходных реле
	* Аппаратная задержка отключения транзистора (с помощью dma, pwm и hrtim)
	* своя реализация записи во флеш


# Инструкция по сборке и установки встраиваемого ПО автомата розеточного

### 1.	Средства разработки
 Встраиваемое ПО автомата розеточного (АР) разрабатывалось с использованием языка программирования С/С++ и следующих программных средств:
  *	ОС Linux Debian 3.16.59-1 (2018-10-03) i686
  *	IDE System Work Bench for STM32
  *	Среда автоматизированного проектирования STM32CubeMX версии 4.27.0
  *	Система контроля версий git

Установка выше перечисленных средств осуществляется в соответствии с их документацией.

### 2.	Сборка ПО

Для сборки ПО необходим установленный на пользовательской ЭВМ дистрибутив IDE System Work Bench for STM32. Установка дистрибутива осуществляется в соответствии с его документацией.
 * Порядок сборки:
  *	Загрузить проект из локального репозитория GitLab. Для этого: 
    * В ОС Linux нажать Alt+F2;
    * В появившемся окне ввести слово konsole и нажать кнопку Enter;
    * В окне терминала ввести команду: 
    *		git clone http://192.168.1.102/axiom-v50-embed/ar-v2-h743.git
    * Перейти в полученную директорию по команде: cd ar-v2-h743/
    * Переключиться на мастер ветку с помощью команды: git checkout master

  *	Запустить IDE System Work Bench for STM32;
  *	Нажать кнопку Browse, выбрать путь к воркспэйсу ../ar-v2-h743/ и нажать Ok;
  *	При открытии пустого воркспейса необходимо импортировать в него проект, выполнив следующие операции:
    * Нажать File->Import;
    * В появившемся окне выбрать General->Existing Projects into Workspace и нажать кнопку Next;
    * В появившемся окне выбрать Select root directory и нажать Browse;
    * Выбрать путь ../ar-v2-h743/SW4STM32/ и нажать Ok.
    * Нажать кнопку Finish.
  * Для сборки проекта нажмите Project->Build All;
  * При удачной сборке проекта в директории ../ar-v2-h743/SW4STM32/ar-v2-h743/Debug появится набор исполняемых файлов прошивки: 	ar-v2-h743.hex и ar-v2-h743.elf

### 3.	Установка ПО

Порядок записи исполняемых файлов прошивки ar-v2-h743.hex или ar-v2-h743.elf в память АР:
  *	Подключить программатор к ЭВМ;
  *	Ответную часть кабеля программатора подключить к АР в соответствии с Э3 на АР;
  *	При необходимости выполнить пункты раздела 2 (Сборка ПО)
  *	Для записи прошивки в память АР загрузить проект в IDE System Work Bench for STM32 и в открывшемся проекте нажать Run->Run, либо воспользоваться утилитой STM32 ST-LINK Utility.


